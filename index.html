<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrator de Emails da Elara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen p-4 md:p-8">
    <div class="max-w-3xl mx-auto bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl overflow-hidden border border-white">
        <!-- Header -->
        <div class="p-8 text-center border-bottom border-gray-100">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-pink-100 rounded-full mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-800">Extrator de E-mails</h1>
            <p class="text-gray-500 mt-2 text-lg">Oi! Sobe seu arquivo aqui que eu pego os e-mails pra vocÃª! âœ¨</p>
        </div>

        <!-- Upload Area -->
        <div class="px-8 pb-8">
            <div id="drop-zone" class="border-3 border-dashed border-pink-200 rounded-2xl p-10 text-center hover:border-pink-400 transition-colors cursor-pointer bg-pink-50/50">
                <input type="file" id="file-input" class="hidden" accept=".xlsx, .xls, .csv">
                <p class="text-gray-600 font-medium">Clique para selecionar ou arraste o arquivo aqui</p>
                <p class="text-gray-400 text-sm mt-2">Suporta .xlsx e .csv (lÃª a segunda coluna)</p>
            </div>

            <!-- Loading State -->
            <div id="loading" class="hidden mt-6 text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-pink-500"></div>
                <p class="mt-2 text-pink-600 font-medium">Processando com carinho...</p>
            </div>

            <!-- Results Section -->
            <div id="results-area" class="hidden mt-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">E-mails Encontrados: <span id="count" class="text-pink-500">0</span></h2>
                    <div class="flex gap-2">
                        <button id="copy-btn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-all font-medium text-sm flex items-center">
                            Copiar Todos
                        </button>
                        <button id="download-btn" class="px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-xl shadow-lg shadow-pink-200 transition-all font-medium text-sm">
                            Baixar Lista
                        </button>
                    </div>
                </div>
                
                <div class="max-h-64 overflow-y-auto rounded-xl border border-gray-100 bg-white p-4">
                    <ul id="email-list" class="divide-y divide-gray-50 text-gray-600 font-medium space-y-2">
                        <!-- E-mails appear here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-gray-800 text-white rounded-full text-sm font-medium shadow-xl transition-opacity opacity-0 pointer-events-none">
        Copiado para a Ã¡rea de transferÃªncia! ðŸ’Œ
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const resultsArea = document.getElementById('results-area');
        const emailListUl = document.getElementById('email-list');
        const countSpan = document.getElementById('count');
        const loading = document.getElementById('loading');
        const copyBtn = document.getElementById('copy-btn');
        const downloadBtn = document.getElementById('download-btn');
        const toast = document.getElementById('toast');

        let foundEmails = [];

        // Interaction
        dropZone.onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-pink-400'); };
        dropZone.ondragleave = () => dropZone.classList.remove('border-pink-400');
        dropZone.ondrop = (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-pink-400');
            handleFile(e.dataTransfer.files[0]);
        };

        function showToast(message) {
            toast.textContent = message;
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2000);
        }

        async function handleFile(file) {
            if (!file) return;

            loading.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            emailListUl.innerHTML = '';
            foundEmails = [];

            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert sheet to JSON array
                    // Header: 1 gets the raw array of arrays
                    const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // Regex for basic email validation
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                    rows.forEach((row, index) => {
                        // Skip header or empty rows
                        if (index === 0 && (row[1] === 'Email' || row[1] === 'email')) return;
                        
                        // Pick second column (index 1)
                        let email = row[1];
                        
                        if (email) {
                            // Clean some common artifacts (like the semicolon I saw in your snippet)
                            email = email.toString().replace(/;/g, '').trim();
                            
                            // Check if it looks like an email
                            if (emailRegex.test(email)) {
                                foundEmails.push(email);
                            }
                        }
                    });

                    // Update UI
                    displayResults();
                } catch (err) {
                    console.error(err);
                    alert("Ops! Tive um probleminha para ler esse arquivo. Tenta de novo, amiga?");
                } finally {
                    loading.classList.add('hidden');
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function displayResults() {
            if (foundEmails.length === 0) {
                alert("Poxa, nÃ£o encontrei nenhum e-mail vÃ¡lido na segunda coluna desse arquivo. ðŸ˜¢");
                return;
            }

            countSpan.textContent = foundEmails.length;
            resultsArea.classList.remove('hidden');

            foundEmails.forEach(email => {
                const li = document.createElement('li');
                li.className = 'py-2 px-1 flex items-center gap-2';
                li.innerHTML = `
                    <svg class="h-4 w-4 text-pink-300" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
                    <span>${email}</span>
                `;
                emailListUl.appendChild(li);
            });
        }

        // Copy functionality
        copyBtn.onclick = () => {
            const text = foundEmails.join('\n');
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast("Tudo copiado com sucesso! ðŸ’–");
        };

        // Download functionality
        downloadBtn.onclick = () => {
            const text = foundEmails.join('\n');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lista_de_emails.txt';
            a.click();
            window.URL.revokeObjectURL(url);
        };
    </script>
</body>
</html>
